# npmの権限を修正

ひょっとすると、パッケージをグローバルインストールしようとした際に**EACESS**エラーが発生するかもしれません。npmがグローバルなパッケージ及びコマンドを格納するディレクトリへの書き込み権限がないケースです。  

この問題は、次の3つの選択肢のうちいずれかで解決できます。  

1. npmのデフォルトディレクトリの権限を変更する
1. npmのデフォルトディレクトリを他のディレクトリに変更する
1. 環境に合わせてnodeをインストールしてくれるパッケージマネージャを使う

実施前に、コンピュータのバックアップを取っておきましょう。

## 選択肢1. npmのデフォルトディレクトリの権限を変更する

1. npmディレクトリまでのパスを確認します。  
    ```shell
     npm config get prefix
    ```
    **/usr/local**であることが多いです。  

    注意:  
    パスが**/usr**だった場合、**選択肢2.**を使うようにして下さい。そうしないと権限が滅茶苦茶になります。  

1. npmディレクトリのオーナーをカレントユーザの名前(今使っているユーザ名)に変更します。  
    ```shell
    sudo chown -R $(whoami) $(npm config get prefix)/{lib/node_modules,bin,share}
    ```
    これでnpmやそれ以外のツール(**lib/node_modules**、**bin**、**share**)が使うサブディレクトリのパーミッションも変更されます。

## 選択肢2. npmのデフォルトディレクトリを他のディレクトリに変更する

npmが使用するディレクトリのオーナーを変更したくない場合もあるでしょう(**/usr**のように)。例えばシステムを他のユーザと共有していたりすると、変更が問題を引き起こしかねません。  

かわりに、npmが全く別のディレクトリを使用するよう設定できます。例えば私たちは、ホームディレクトリ内の隠しディレクトリを使っています。  

1. グローバルインストール用のディレクトリを作成します。  
    ```shell
    mkdir ~/.npm-global
    ```
1. 新しいディレクトリのパスをnpmに設定します。  
    ```shell
    npm config set prefix '~/.npm-global'
    ```
1. **~/.profile**ファイルを開き(ない場合は作成し)、次の行を追記します。  
    ```shell
    export PATH=~/.npm-global/bin:$PATH
    ```
1. コマンドラインに戻り、システム変数を更新します。  
    ```shell
    source ~/.profile
    ```

テスト:  
`sudo`を使わず、パッケージをグローバルレベルでダウンロードしてみて下さい。  
```shell
npm install -g jshint
```

手順2〜4のかわりに、環境変数で対応することも可能です(例えば、**~/.profile**を編集したくない場合)。  
```shell
NPM_CONFIG_PREFIX=~/.npm-global
```

## 選択肢3. 環境に合わせてnodeをインストールしてくれるパッケージマネージャを使う

Mac OS上で新たにnodeをインストールするなら、[Homebrew](http://brew.sh/)パッケージマネージャを使うことでこの問題を回避出来ます。Homebrewは適切なパーミッションとともにセットアップを行ってくれるので、すぐ使えるようになります。
```
brew install node
```